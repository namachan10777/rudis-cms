{%- for table in tables %}
CREATE TABLE IF NOT EXISTS {{ table.table }} (
    {%- for column in table.primary_keys %}
    {{ column.name }} TEXT NOT NULL,
    {%- endfor -%}
    {%- for column in table.data_columns %}
    {{ column.name }} {{ column.type }}{% if column.not_null %} NOT NULL{% endif %},
    {%- endfor -%}
    {% if table.parent != nil %}
    FOREIGN KEY ({{ table.primary_Keys | where: "reference", true | map: "name" | join: ", " }}) REFERENCES {{ table.parent.table }}({{ table.parent.parent_ids | join: ", " }}) ON DELETE CASCADE,
    {%- endif %}
    PRIMARY KEY ({{ table.primary_keys | map: "name" | join: ", " }})
);
{% for column in table.data_columns -%}
{%- if column.index != nil %}
CREATE INDEX IF NOT EXISTS index_{{ table.table }}_{{ column.name }} ON {{ table.table }}({{ column.index }});
{%- endif %}
{% endfor %}
{% endfor -%}
